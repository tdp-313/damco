(function(){"use strict";const o=async e=>{let r=await e.getFile(),l="★";if(r.name.length>3){let f=r.name.substring(r.name.indexOf(".")+1,r.name.length);isNaN(Number(f))||(l=Number(f),l<10&&(l=l))}let t={timestamp:await r.lastModifiedDate.toLocaleString(),text:"",textArray:[],encode:"utf-8",ext:l,handle:e};const n=await(await fetch(URL.createObjectURL(r))).arrayBuffer(),u=new TextDecoder("utf-8").decode(n);let s=u;if(u.includes("�")){const p=new TextDecoder("Shift-JIS").decode(n);p.includes("�")||(s=p,t.encode="Shift-JIS")}if(s==="")return t;t.text=s;let g=s.split(/\r\n|\r|\n/);return t.textArray=g,t};self.onmessage=async e=>{let d=typeof e.data.uri>"u"?null:e.data.uri,r=typeof e.data.searchQuery>"u"?null:e.data.searchQuery;if(e.data.type==="fileOpen"||e.data.type==="fileOpen_change"){self.postMessage({type:e.data.type,body:await o(e.data.body),target:e.data.target,uri:d});return}else if(e.data.type==="fileSearch"){self.postMessage({type:e.data.type,body:await y(e.data.body,r),target:e.data.target,uri:d});return}const l=e.data.body,i=[];for await(const[a,n]of l.entries())if(e.data.kind===n.kind){const c=a.replace(/\.[^/.]+$/,"");i.push({name:c,handle:n,type:n.kind})}i.sort((a,n)=>a.name<n.name?-1:a.name>n.name?1:0);let t=new Map;i.forEach(a=>{t.set(a.name,a.handle)}),self.postMessage({type:e.data.type,target:e.data.target,body:t,uri:d})};const y=async(e,d)=>{let r=await o(e);if(d.every(i=>i===""))return null;let l=!0;for(let i=0;i<d.length;i++){if(d[i]==="")continue;let t=d[i],a;if(t.includes("%")){let n=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/%/g,".*").replace(/_/g,".");a=new RegExp(n)}else a=new RegExp(t);if(!a.test(r.text)){l=!1;break}}return l?r:null}})();
