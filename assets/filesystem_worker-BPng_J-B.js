(function(){"use strict";self.onmessage=async t=>{if(t.data.type==="fileOpen"||t.data.type==="fileOpen_change"){self.postMessage({type:t.data.type,body:await u(t.data.body)});return}const d=t.data.body,a=[];for await(const[i,e]of d.entries())if(t.data.kind===e.kind){const r=i.replace(/\.[^/.]+$/,"");a.push({name:r,handle:e,type:e.kind})}a.sort((i,e)=>i.name<e.name?-1:i.name>e.name?1:0);let n=new Map;a.forEach(i=>{n.set(i.name,i.handle)}),self.postMessage({type:t.data.type,body:n})};const u=async t=>{let a=await t.getFile(),n="★";if(a.name.length>3){let s=a.name.substring(a.name.indexOf(".")+1,a.name.length);isNaN(Number(s))||(n=Number(s),n<10&&(n=n))}let e={timestamp:await a.lastModifiedDate.toLocaleString(),text:"",encode:"utf-8",ext:n,handle:t};const f=await(await fetch(URL.createObjectURL(a))).arrayBuffer(),c=new TextDecoder("utf-8").decode(f);let o=c;if(c.includes("�")){const l=new TextDecoder("Shift-JIS").decode(f);l.includes("�")||(o=l,e.encode="Shift-JIS")}return o===""||(e.text=o),e}})();
