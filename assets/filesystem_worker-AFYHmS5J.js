(function(){"use strict";const f=async e=>{let t=await e.getFile(),r="★";if(t.name.length>3){let o=t.name.substring(t.name.indexOf(".")+1,t.name.length);isNaN(Number(o))||(r=Number(o),r<10&&(r=r))}let n={timestamp:await t.lastModifiedDate.toLocaleString(),text:"",textArray:[],encode:"utf-8",ext:r,handle:e};const d=await(await fetch(URL.createObjectURL(t))).arrayBuffer(),u=new TextDecoder("utf-8").decode(d);let s=u;if(u.includes("�")){const y=new TextDecoder("Shift-JIS").decode(d);y.includes("�")||(s=y,n.encode="Shift-JIS")}if(s==="")return n;n.text=s;let g=s.split(/\r\n|\r|\n/);return n.textArray=g,n};self.onmessage=async e=>{let i=typeof e.data.uri>"u"?null:e.data.uri,t=typeof e.data.searchQuery>"u"?null:e.data.searchQuery;if(e.data.type==="fileOpen"||e.data.type==="fileOpen_change"){self.postMessage({type:e.data.type,body:await f(e.data.body),target:e.data.target,uri:i});return}else if(e.data.type==="fileSearch"){self.postMessage({type:e.data.type,body:await p(e.data.body,t),target:e.data.target,uri:i});return}const r=e.data.body,a=[];for await(const[l,d]of r.entries())if(e.data.kind===d.kind){const c=l.replace(/\.[^/.]+$/,"");a.push({name:c,handle:d,type:d.kind})}a.sort((l,d)=>l.name<d.name?-1:l.name>d.name?1:0);let n=new Map;a.forEach(l=>{n.set(l.name,l.handle)}),self.postMessage({type:e.data.type,target:e.data.target,body:n,uri:i})};const p=async(e,i)=>{let t=await f(e);if(i.every(a=>a===""))return null;let r=!0;for(let a=0;a<i.length;a++){if(i[a]==="")continue;if(!new RegExp(i[a]).test(t.text)){r=!1;break}}return r?t:null}})();
